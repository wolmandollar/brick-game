<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ë¸Œë¦­ ë¸Œë ˆì´ì»¤ (ë¯¸ë‹ˆ)</title>
<style>
  :root{
    /* í…Œë§ˆ ìƒ‰ìƒ â€“ í•„ìš” ì‹œ Adobe Color HEXë¡œ êµì²´í•˜ì„¸ìš” */
    --bg:#0f172a;        /* ë°°ê²½ */
    --fg:#e2e8f0;        /* ê¸€ì */
    --accent:#38bdf8;    /* í¬ì¸íŠ¸ */
    --brick1:#7dd3fc; --brick2:#a78bfa; --brick3:#34d399; --brick4:#f59e0b; --brick5:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; display:flex; flex-direction:column; align-items:center; gap:12px;
    background:radial-gradient(800px 600px at 20% 15%, rgba(56,189,248,.12), transparent 60%),
               linear-gradient(135deg, var(--bg), #0b132b 70%, #090f1c);
    color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;
    padding:18px;
  }
  header{width:100%; max-width:900px; display:flex; align-items:center; justify-content:space-between; gap:10px}
  .title{font-weight:800; letter-spacing:.2px}
  .hud{display:flex; gap:12px; font-weight:700}
  .chip{padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12)}
  .panel{width:100%; max-width:900px; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .btn{padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.06); color:var(--fg); font-weight:800; cursor:pointer}
  .note{opacity:.75; font-size:13px}
  .wrap{width:100%; max-width:900px; aspect-ratio:16/9; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.15); background:#0b1220}
  canvas{width:100%; height:100%; display:block; background:transparent}
  .center-msg{
    position:absolute; inset:0; display:grid; place-items:center; pointer-events:none;
    color:var(--fg); text-align:center; padding:16px; font-weight:800; text-shadow:0 2px 10px rgba(0,0,0,.4)
  }
  .hidden{display:none}
</style>
</head>
<body>
  <header>
    <div class="title">ğŸ§± ë¸Œë¦­ ë¸Œë ˆì´ì»¤ (ë¯¸ë‹ˆ)</div>
    <div class="hud">
      <div class="chip">ì ìˆ˜: <span id="score">0</span></div>
      <div class="chip">ìŠ¤í…Œì´ì§€: <span id="stage">1</span></div>
      <div class="chip">ëª©ìˆ¨: <span id="lives">3</span></div>
    </div>
  </header>

  <section class="panel">
    <div class="note">ì´ë™: â† â†’ ë˜ëŠ” A/D Â· ì‹œì‘/ì¼ì‹œì •ì§€: Space/í´ë¦­ Â· ëª¨ë°”ì¼ì€ íŒ¨ë“¤ ë“œë˜ê·¸</div>
    <div>
      <button id="startBtn" class="btn">â–¶ ì‹œì‘/ì¼ì‹œì •ì§€</button>
      <button id="resetBtn" class="btn">âŸ³ ë¦¬ì…‹</button>
    </div>
  </section>

  <div class="wrap" id="wrap" style="position:relative">
    <canvas id="game" width="900" height="506"></canvas>
    <div id="msg" class="center-msg">í´ë¦­ ë˜ëŠ” Spaceë¡œ ì‹œì‘!</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const wrap = document.getElementById('wrap');
  const scoreEl = document.getElementById('score');
  const stageEl = document.getElementById('stage');
  const livesEl = document.getElementById('lives');
  const msgEl = document.getElementById('msg');

  // ê²Œì„ ìƒíƒœ
  let running = false;
  let over = false;
  let score = 0;
  let stage = 1;
  let lives = 3;

  // íŒ¨ë“¤/ê³µ
  const paddle = { w: 110, h: 14, x: canvas.width/2-55, y: canvas.height-28, speed: 8 };
  const ball = { x: canvas.width/2, y: canvas.height-60, r: 8, vx: 4, vy: -4, speed: 5.0 };

  // ë²½ëŒ
  const rowsBase = 5, colsBase = 10, brickPad = 8, topOffset = 60, sideOffset = 26;
  let bricks = [];

  const colors = ['var(--brick1)','var(--brick2)','var(--brick3)','var(--brick4)','var(--brick5)'];

  function initStage(n){
    // ì†ë„/í–‰ì—´ ì¦ê°€ë¡œ ë‚œì´ë„ ì¡°ì ˆ
    const rows = rowsBase + Math.floor((n-1)%3);
    const cols = colsBase + (n>2?1:0);
    const brickW = (canvas.width - sideOffset*2 - (cols-1)*brickPad) / cols;
    const brickH = 22;

    bricks = [];
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        bricks.push({
          x: sideOffset + c*(brickW+brickPad),
          y: topOffset + r*(brickH+brickPad),
          w: brickW, h: brickH,
          hp: 1 + Math.floor((n-1)/2), // ìŠ¤í…Œì´ì§€ê°€ ì˜¤ë¥¼ìˆ˜ë¡ ì²´ë ¥ ì¦ê°€
          color: colors[r%colors.length]
        });
      }
    }

    // íŒ¨ë“¤/ê³µ ì´ˆê¸°í™”
    paddle.x = canvas.width/2 - paddle.w/2;
    ball.x = canvas.width/2; ball.y = canvas.height - 60;
    const base = 4 + Math.min(4, n-1)*0.6;
    ball.vx = base * (Math.random()<0.5?-1:1);
    ball.vy = -base;
    over = false;
    draw(); // ì´ˆê¸° ë Œë”
  }

  // ì…ë ¥
  const keys = {};
  window.addEventListener('keydown', (e)=>{
    if(['ArrowLeft','ArrowRight','a','d','A','D',' '].includes(e.key)) e.preventDefault();
    keys[e.key] = true;
    if(e.key === ' ') toggleRun();
  });
  window.addEventListener('keyup', (e)=>{ keys[e.key] = false; });

  // ë§ˆìš°ìŠ¤/í„°ì¹˜ë¡œ íŒ¨ë“¤ ì´ë™
  let dragging = false;
  wrap.addEventListener('pointerdown', (e)=>{ dragging=true; if(!running) toggleRun(); movePaddle(e); });
  wrap.addEventListener('pointermove', (e)=>{ if(dragging) movePaddle(e); });
  wrap.addEventListener('pointerup', ()=> dragging=false);
  function movePaddle(e){
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * (canvas.width/rect.width);
    paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, x - paddle.w/2));
  }

  function toggleRun(){
    if(over){ // ê²Œì„ì˜¤ë²„ ìƒíƒœì—ì„œ ëˆ„ë¥´ë©´ ë¦¬ì…‹
      resetGame();
      return;
    }
    running = !running;
    msgEl.textContent = running ? '' : 'ì¼ì‹œì •ì§€ (Space/í´ë¦­ìœ¼ë¡œ ì¬ì‹œì‘)';
    msgEl.classList.toggle('hidden', running);
  }

  // ë²„íŠ¼
  document.getElementById('startBtn').onclick = toggleRun;
  document.getElementById('resetBtn').onclick = resetGame;

  function resetGame(){
    score = 0; stage = 1; lives = 3;
    scoreEl.textContent = score; stageEl.textContent = stage; livesEl.textContent = lives;
    initStage(stage);
    running = false; over = false;
    msgEl.textContent = 'í´ë¦­ ë˜ëŠ” Spaceë¡œ ì‹œì‘!'; msgEl.classList.remove('hidden');
  }

  // ì¶©ëŒ í—¬í¼
  function rectHitCircle(rx, ry, rw, rh, cx, cy, cr){
    // ì›-ì‚¬ê° ì¶©ëŒ (í´ë¨í”„)
    const nx = Math.max(rx, Math.min(cx, rx+rw));
    const ny = Math.max(ry, Math.min(cy, ry+rh));
    const dx = cx - nx, dy = cy - ny;
    return (dx*dx + dy*dy) <= cr*cr;
  }

  function update(){
    // ì…ë ¥ ì´ë™
    if(keys['ArrowLeft']||keys['a']||keys['A'])  paddle.x -= paddle.speed;
    if(keys['ArrowRight']||keys['d']||keys['D']) paddle.x += paddle.speed;
    paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, paddle.x));

    // ê³µ ì´ë™
    ball.x += ball.vx; ball.y += ball.vy;

    // ë²½ ë°˜ì‚¬
    if(ball.x < ball.r){ ball.x = ball.r; ball.vx *= -1; }
    if(ball.x > canvas.width - ball.r){ ball.x = canvas.width - ball.r; ball.vx *= -1; }
    if(ball.y < ball.r){ ball.y = ball.r; ball.vy *= -1; }

    // íŒ¨ë“¤ ì¶©ëŒ(ìŠ¤ìœ—ìŠ¤íŒŸ ë°˜ì‚¬)
    if(rectHitCircle(paddle.x, paddle.y, paddle.w, paddle.h, ball.x, ball.y, ball.r)){
      ball.y = paddle.y - ball.r;
      const hit = (ball.x - (paddle.x + paddle.w/2)) / (paddle.w/2); // -1 ~ 1
      const speed = Math.hypot(ball.vx, ball.vy);
      const angle = hit * Math.PI/3; // ìµœëŒ€ Â±60ë„
      ball.vx = speed * Math.sin(angle);
      ball.vy = -Math.abs(speed * Math.cos(angle));
    }

    // ë²½ëŒ ì¶©ëŒ
    for(let i=0;i<bricks.length;i++){
      const b = bricks[i];
      if(!b.hp) continue;
      if(rectHitCircle(b.x, b.y, b.w, b.h, ball.x, ball.y, ball.r)){
        // ê°„ë‹¨í•œ ë°˜ì‚¬: ë” ê°•í•˜ê²Œ ë§ì€ ì¶• ë°˜ì „
        const prevX = ball.x - ball.vx, prevY = ball.y - ball.vy;
        const hitX = prevX < b.x || prevX > b.x + b.w;
        if(hitX) ball.vx *= -1; else ball.vy *= -1;

        b.hp -= 1;
        score += 10; scoreEl.textContent = score;
        if(b.hp<=0) bricks.splice(i,1);
        break;
      }
    }

    // ë°”ë‹¥ìœ¼ë¡œ ë–¨ì–´ì§
    if(ball.y > canvas.height + 40){
      lives--; livesEl.textContent = lives;
      if(lives<=0){ gameOver(false); return; }
      // ê³µ/íŒ¨ë“¤ë§Œ ì¬ë°°ì¹˜ í›„ ì¼ì‹œì •ì§€
      paddle.x = canvas.width/2 - paddle.w/2;
      ball.x = canvas.width/2; ball.y = canvas.height - 60;
      ball.vx = (Math.random()<0.5?-1:1)*4; ball.vy = -4;
      running = false; msgEl.textContent = 'ì‹¤ìˆ˜ëŠ” ëˆ„êµ¬ë‚˜! Space/í´ë¦­ìœ¼ë¡œ ì¬ë„ì „'; msgEl.classList.remove('hidden');
    }

    // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´
    if(bricks.length===0){
      stage++; stageEl.textContent = stage;
      score += 100; scoreEl.textContent = score;
      initStage(stage);
      running = false; msgEl.textContent = `ìŠ¤í…Œì´ì§€ ${stage-1} í´ë¦¬ì–´! Space/í´ë¦­ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„`; msgEl.classList.remove('hidden');
    }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // ë²½ëŒ
    bricks.forEach(b=>{
      if(!b.hp) return;
      ctx.fillStyle = b.color;
      ctx.fillRect(b.x, b.y, b.w, b.h);
      // í…Œë‘ë¦¬
      ctx.strokeStyle = 'rgba(0,0,0,.25)';
      ctx.strokeRect(b.x+0.5, b.y+0.5, b.w-1, b.h-1);
    });

    // íŒ¨ë“¤
    ctx.fillStyle = 'var(--fg)';
    ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

    // ê³µ
    ctx.beginPath();
    ctx.fillStyle = 'var(--accent)';
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fill();
  }

  function loop(){
    if(running) update();
    draw();
    request
